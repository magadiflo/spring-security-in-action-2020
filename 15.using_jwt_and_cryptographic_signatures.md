# [Pág. 360] Capítulo 15 - OAuth 2: uso de JWT y firmas criptográficas

Aprendió en el capítulo 14 que el servidor de recursos necesita validar tokens emitidos por el servidor de autorización.
Y te dije tres maneras de hacer esto:

1. Usar llamadas directas entre el servidor de recursos y el servidor de autorizaciones, que implementamos en la sección
   14.2.
2. Usar una base de datos compartida para almacenar los tokens, que implementamos en la sección 14.3.
3. **Uso de firmas criptográficas**, de las que hablaremos en este capítulo.

El uso de firmas criptográficas para validar tokens tiene la ventaja de permitir que el servidor de recursos los valide
sin necesidad de llamar directamente al servidor de autorización y sin necesidad de una base de datos compartida. **Este
enfoque para implementar la validación de tokens se usa comúnmente en sistemas que implementan autenticación y
autorización con OAuth 2.** Por este motivo, debe conocer esta forma de implementar la validación de tokens.

## [Pág. 361] Usando tokens firmados con claves simétricas con JWT

**El enfoque más sencillo** para firmar tokens es **usar claves simétricas.** Con este enfoque, **utilizando la misma
clave,** puede **firmar un token y validar su firma.** El uso de **claves simétricas** para firmar tokens tiene la
ventaja de ser **más simple** que otros enfoques que discutiremos más adelante en este capítulo y también es **más
rápido.** Como verá, sin embargo, también tiene desventajas. No siempre puede compartir la clave utilizada para firmar
tokens con todas las aplicaciones involucradas en el proceso de autenticación.

## [Pág. 361] Usando JWTs

**Un JWT es una implementación de token.** Un jwt consta de **tres partes**: **el encabezado, el cuerpo y la firma.**
Los detalles en el encabezado y el cuerpo se representan con JSON y están codificados en Base64. La tercera parte es la
firma, generada mediante un algoritmo criptográfico que utiliza como entrada la cabecera y el cuerpo (figura 15.1). El
algoritmo criptográfico también implica la necesidad de una clave. La clave es como una contraseña. Alguien que tenga
una clave adecuada puede firmar un token o validar que una firma sea auténtica. Si la firma en un token es auténtica,
eso garantiza que nadie alteró el token después de haberlo firmado.

![figure-15-1](./assets/figure-15-1.png)

**Cuando se firma un JWT, también lo llamamos JWS (JSON Web Token Signed).** Por lo general, basta con aplicar un
algoritmo criptográfico para firmar un token, pero a veces puede optar por cifrarlo. Si se firma un token, puede ver
su contenido sin tener ninguna clave o contraseña. Pero incluso si un hacker ve el contenido del token, no puede
cambiar el contenido del token porque si lo hace, la firma se vuelve inválida (figura 15.2). Para ser válida,
una firma debe:

- Ser generado con la clave correcta.
- Hacer coincidir el contenido que se firmó.

![figure-15-2](./assets/figure-15-2.png)

**Si un token está encriptado, también lo llamamos JWE (JSON Web Token Encrypted).** No puede ver el contenido de un
token encriptado sin una clave válida.
